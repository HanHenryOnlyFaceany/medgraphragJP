# 图处理检查点恢复功能

## 功能概述

本项目新增了检查点恢复功能，用于解决程序中断后需要重新开始处理的问题。当处理大量数据时，如果程序中断，现在可以从上次中断的位置继续处理，而不需要重新开始。

## 主要特性

1. **自动检查点保存**：在处理每个内容块后，会自动保存当前进度到检查点文件
2. **分块内容缓存**：将分块后的内容保存到缓存文件，以便在程序重启后恢复
3. **错误处理**：当处理过程中出现错误，会保存当前进度并抛出异常
4. **恢复处理**：提供专门的脚本用于从检查点恢复处理

## 使用方法

### 正常处理

正常使用 `run.py` 进行图处理，检查点功能会自动工作：

```bash
python run.py -construct_graph -grained_chunk -ingraphmerge -dataset mimic_ex -data_path ./dataset_cn
```

### 查看可用检查点

如果程序中断，可以使用以下命令查看所有可用的检查点：

```bash
python resume_processing.py -list
```

### 从检查点恢复

确定要恢复的图元素组ID后，使用以下命令从检查点恢复处理：

```bash
python resume_processing.py -resume <GID>
```

其中 `<GID>` 是要恢复的图元素组ID。

## 文件说明

- **checkpoints/checkpoint_<GID>.json**：保存处理进度的检查点文件
- **checkpoints/chunks_<GID>.json**：保存分块内容的缓存文件

## 注意事项

1. 检查点文件会在处理完成后自动删除
2. 分块缓存文件会保留，以便在需要时重新处理
3. 恢复处理时需要设置Neo4j环境变量：NEO4J_URL, NEO4J_USERNAME, NEO4J_PASSWORD

## 技术实现

检查点机制通过以下方式实现：

1. 在处理每个内容块前，检查该块是否已经处理过
2. 在处理每个内容块后，保存当前进度到检查点文件
3. 当程序重新启动时，从检查点文件中加载进度信息
4. 跳过已经处理过的内容块，从未处理的内容块开始继续处理

这种方式确保了即使在处理大量数据时程序中断，也能够从中断点继续处理，而不需要重新开始。